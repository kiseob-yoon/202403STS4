<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ks.repository.StoreMapper">
	<select id="selectCount" resultType="Integer">
		select count(*) from store
	</select>


	<select id="selectStoreList" resultType="com.ks.dto.Store">
		<![CDATA[
			SELECT
				id,
				storename,
				business,
				tel,
				address,
				grade,
				thema,
				latitude,
				longitude
			FROM
				store
			ORDER BY id desc
		]]>
	</select>

	<select id="selectStoretById" resultType="com.ks.dto.Store">
		<![CDATA[
			SELECT
				id,
				storename,
				business,
				tel,
				address,
				grade,
				thema,
				latitude,
				longitude,
				likes,
				hits
			FROM
				store
			where id = #{id}
		]]>
	</select>

	<insert id="insertStore" parameterType="com.ks.dto.Store"> 
	<![CDATA[
			INSERT INTO store
			(
				storename,
				business,
				tel,
				address,
				grade,
				thema,
				latitude,
				longitude
			) 
			VALUES 
			(
				#{storename}, 
				#{business},
				#{tel},
				#{address},
				#{grade},
				#{thema},
				#{latitude},
				#{longitude}
			)
		]]>
	</insert>

	<delete id="deleteStore" parameterType="int">
	<![CDATA[
		delete from store where id = #{id}
	
	]]>
	</delete>

	<update id="updateStore" parameterType="com.ks.dto.Store">
    	<![CDATA[
    update store set 
    storename=#{storename}, 
    business=#{business}, 
    tel=#{tel},
    address=#{address},
    grade=#{grade},
    thema=#{thema},
    latitude=#{latitude},
    longitude=#{longitude} 
    where id = #{id}
    	]]>
	</update>
	
	<update id="updateHits" parameterType="com.ks.dto.Store">
		<![CDATA[
		UPDATE store
		SET hits = hits + 1
		WHERE id = #{id};
		
		]]>
	</update>
	
	<select id="checkLikeExists" resultType="Integer">
		SELECT COUNT(*) FROM likes 
		WHERE member_id = #{memberId} AND store_id = #{storeId}
	</select>
	
	<insert id="addLike" parameterType="com.ks.dto.Store"> 
		<![CDATA[
		INSERT INTO likes (member_id, store_id) 
		VALUES (#{memberId}, #{storeId})
		]]>
	</insert>
	
	
	<insert id="incrementLikeCount" parameterType="com.ks.dto.Store"> 
		<![CDATA[
		UPDATE store SET likes = likes + 1 WHERE id = #{id}
		]]>
	</insert>
	
	<select id="selectRank" resultType="com.ks.dto.Store">
    	<![CDATA[
	SELECT id, storename, business, address, RANK() OVER (ORDER BY hits DESC) AS store_rank
	FROM store
	ORDER BY hits DESC
	LIMIT 10;
    	]]>
	</select>

	
	
	
	



</mapper>